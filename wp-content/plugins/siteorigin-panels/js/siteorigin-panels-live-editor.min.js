!function(e,t,i){var o=window.siteoriginPanels;o.view.liveEditor=Backbone.View.extend({template:t.template(e("#siteorigin-panels-live-editor").html().panelsProcessTemplate()),sectionTemplate:t.template(e("#siteorigin-panels-live-editor-sidebar-section").html().panelsProcessTemplate()),postId:!1,bodyScrollTop:null,displayed:!1,events:{"click .live-editor-close":"close"},frameScrollTop:0,initialize:function(){},render:function(){this.setElement(this.template()),this.$el.html(this.template());var t=this;this.$("iframe#siteorigin-panels-live-editor-iframe").load(function(){e(this).show();var i=e(this).contents();i.find(".panel-grid .panel-grid-cell .so-panel.widget").filter(function(){return 0==e(this).parents(".widget_siteorigin-panels-builder").length}).each(function(i,o){var n,s=e(o),r=t.$(".page-widgets .so-widget").eq(i);s.css({cursor:"pointer"}).mouseenter(function(){r.addClass("so-hovered"),n=t.createPreviewOverlay(e(this))}).mouseleave(function(){r.removeClass("so-hovered"),n.fadeOut("fast",function(){e(this).remove()})}).click(function(e){e.preventDefault(),r.click()})}),i.find("a").css({"pointer-events":"none"}).click(function(e){return!1})})},attach:function(){this.$el.appendTo("body")},setPostId:function(e){this.postId=e},open:function(){""===this.$el.html()&&this.render(),0===this.$el.closest("body").length&&this.attach(),this.refreshWidgets(),this.$el.show(),this.refreshPreview(),this.bodyScrollTop=e("body").scrollTop(),e("body").css({overflow:"hidden"}),this.displayed=!0},close:function(){return this.$el.hide(),e("body").css({overflow:"auto"}),e("body").scrollTop(this.bodyScrollTop),this.displayed=!1,!1},refreshPreview:function(){return this.$el.is(":visible")?(this.$("iframe#siteorigin-panels-live-editor-iframe").hide(),this.frameScrollTop=this.$("iframe#siteorigin-panels-live-editor-iframe").contents().find("body").scrollTop(),this.$('form.live-editor-form input[name="siteorigin_panels_data"]').val(JSON.stringify(this.builder.model.getPanelsData())),void this.$("form.live-editor-form").submit()):!1},createPreviewOverlay:function(t){var i=this.$("iframe#siteorigin-panels-live-editor-iframe"),o=i.contents().find("body").css("position","relative");i.contents().find(".panels-live-editor-overlay").remove();var n=e("<div />").addClass("panels-live-editor-overlay").css({"pointer-events":"none"}),s=e("<div />").css({position:"absolute",background:"#000000","z-index":1e4,opacity:.25}),r=15;return n.append(s.clone().css({top:-o.offset().top,left:0,right:0,height:t.offset().top-r})).append(s.clone().css({bottom:0,left:0,right:0,height:Math.round(o.height()-t.offset().top-t.outerHeight()-r+o.offset().top-.01)})).append(s.clone().css({top:t.offset().top-r-o.offset().top,left:0,width:t.offset().left-r,height:Math.ceil(t.outerHeight()+2*r)})).append(s.clone().css({top:t.offset().top-r-o.offset().top,right:0,left:t.offset().left+t.outerWidth()+r,height:Math.ceil(t.outerHeight()+2*r)})),i.contents().find("body").append(n),n},refreshWidgets:function(){this.$(".so-sidebar .page-widgets").empty();var t=this.$("iframe#siteorigin-panels-live-editor-iframe"),i=this,o=0;this.builder.$(".so-row-container").each(function(n,s){var r=e(s),l=r.find(".so-cells .cell .so-widget"),a=e(i.sectionTemplate({title:"Row "+(n+1)})).appendTo(i.$(".so-sidebar .page-widgets"));a.find(".section-header").click(function(){r.data("view").editSettingsHandler()});var d=a.find(".section-widgets");l.each(function(n,s){var r=e(this),l=r.clone().show().css({opacity:1});l.find(".actions").remove(),l.find(".widget-icon").remove();var a=o++,c=function(){return t.contents().find("#pl-"+i.postId+" .panel-grid .panel-grid-cell .widget").filter(function(){return 0===e(this).parents(".widget_siteorigin-panels-builder").length}).not("panel-hover-widget").eq(a)},f=null,h=null;l.click(function(e){return e.preventDefault(),r.data("view").editHandler(),!1}).mouseenter(function(){var e=c();e&&e.offset()&&(t.contents().find("html,body").clearQueue().animate({scrollTop:e.offset().top-Math.max(30,(Math.min(t.contents().height(),t.height())-e.outerHeight())/2)},750),f=i.createPreviewOverlay(e))}).mouseleave(function(){t.contents().find("html,body").clearQueue(),null!==f&&(f.fadeOut("fast",function(){e(this).remove()}),f=null),null!==h&&(h.remove(),h=null)}).appendTo(d)})})},hasPreviewUrl:function(){return""!==this.$("form.live-editor-form").attr("action")}})}(jQuery,_,soPanelsOptions);