!function(e,t,i){var s=window.siteoriginPanels;s.utils={},s.utils.menu=Backbone.View.extend({wrapperTemplate:t.template(e("#siteorigin-panels-context-menu").html().panelsProcessTemplate()),sectionTemplate:t.template(e("#siteorigin-panels-context-menu-section").html().panelsProcessTemplate()),contexts:[],active:!1,events:{"keyup .so-search-wrapper input":"searchKeyUp"},initialize:function(){this.listenContextMenu(),this.render(),this.attach()},listenContextMenu:function(){var t=this;e(window).on("contextmenu",function(e){return t.active&&!t.isOverEl(t.$el,e)?(t.closeMenu(),t.active=!1,e.preventDefault(),!1):t.active?!0:(t.active=!1,t.trigger("activate_context",e,t),void(t.active&&(e.preventDefault(),t.openMenu({left:e.pageX,top:e.pageY}))))})},render:function(){this.setElement(this.wrapperTemplate())},attach:function(){this.$el.appendTo("body")},openMenu:function(t){this.trigger("open_menu"),e(window).on("keyup",{menu:this},this.keyboardListen),e(window).on("click",{menu:this},this.clickOutsideListen),t.left+this.$el.outerWidth()+10>=e(window).width()&&(t.left=e(window).width()-this.$el.outerWidth()-10),t.left<=0&&(t.left=10),t.top+this.$el.outerHeight()-e(window).scrollTop()+10>=e(window).height()&&(t.top=e(window).height()+e(window).scrollTop()-this.$el.outerHeight()-10),t.left<=0&&(t.left=10),this.$el.css({left:t.left+1,top:t.top+1}).show(),this.$(".so-search-wrapper input").focus()},closeMenu:function(){this.trigger("close_menu"),e(window).off("keyup",this.keyboardListen),e(window).off("click",this.clickOutsideListen),this.active=!1,this.$el.empty().hide()},keyboardListen:function(e){var t=e.data.menu;switch(e.which){case 27:t.closeMenu()}},clickOutsideListen:function(e){var t=e.data.menu;3!==e.which&&t.$el.is(":visible")&&!t.isOverEl(t.$el,e)&&t.closeMenu()},addSection:function(i,s,n){var o=this;i=t.extend({display:5,defaultDisplay:!1,search:!0,sectionTitle:"",searchPlaceholder:"",titleKey:"title"},i);var l=e(this.sectionTemplate({settings:i,items:s}));this.$el.append(l),l.find(".so-item").click(function(){var t=e(this);n(t.data("key")),o.closeMenu()}),l.data("settings",i).find(".so-search-wrapper input").trigger("keyup"),this.active=!0},searchKeyUp:function(t){var i=e(t.currentTarget),s=i.closest(".so-section"),n=s.data("settings");if(38===t.which||40===t.which){var o=s.find("ul li:visible"),l=o.filter(".so-active").eq(0);if(0!==l.length){o.removeClass("so-active");var a=o.index(l);38===t.which?l=0>a-1?o.last():o.eq(a-1):40===t.which&&(l=a+1>=o.length?o.first():o.eq(a+1))}else 38===t.which?l=o.last():40===t.which&&(l=o.first());return l.addClass("so-active"),!1}if(13===t.which)return 1===s.find("ul li:visible").length?(s.find("ul li:visible").trigger("click"),!1):(s.find("ul li.so-active:visible").trigger("click"),!1);if(""===i.val())if(n.defaultDisplay){s.find(".so-item").hide();for(var c=0;c<n.defaultDisplay.length;c++)s.find('.so-item[data-key="'+n.defaultDisplay[c]+'"]').show()}else s.find(".so-item").show();else s.find(".so-item").hide().each(function(){var t=e(this);-1!==t.html().toLowerCase().indexOf(i.val().toLowerCase())&&t.show()});s.find(".so-item:visible:gt("+(n.display-1)+")").hide(),0===s.find(".so-item:visible").length&&""!==i.val()?s.find(".so-no-results").show():s.find(".so-no-results").hide()},isOverEl:function(e,t){var i=[[e.offset().left,e.offset().top],[e.offset().left+e.outerWidth(),e.offset().top+e.outerHeight()]];return t.pageX>=i[0][0]&&t.pageX<=i[1][0]&&t.pageY>=i[0][1]&&t.pageY<=i[1][1]}})}(jQuery,_,soPanelsOptions);